---
import { Image } from "astro:assets";
import bgContact from "../../assets/contact-assets/bg-contact.jpg";
import wpIcon from "../../assets/contact-assets/whatsapp-svgrepo-com (1).svg";
const baseUrl = import.meta.env.PUBLIC_BASE_URL;
---

<section class="min-h-svh relative flex flex-col gap-2">
  <Image
    src={bgContact}
    alt="background image"
    class="top-0 w-full h-full object-cover object-right absolute"
  />
  <div class="absolute w-full h-full bg-black/65"></div>
  <h2
    class="relative p-6 text-branco-gelo text-3xl text-center text-outline font-bold font-spectral"
  >
    DÃª o Primeiro Passo Para Defender Seus Direitos
  </h2>
  <h3
    class="relative p-6 font-spectral text-lg text-center text-branco-gelo font-medium"
  >
    Sua mensagem Ã© confidencial e serÃ¡ analisada por um especialista. Preencha o
    formulÃ¡rio abaixo ou, se preferir, nos chame diretamente no <span
      class="text-emerald-500 font-bold">WhatsApp</span
    >.
  </h3>
  <form
    action="https://formsubmit.co/8cad7644f3d0878fa0988faee39f8848"
    method="POST"
    class="relative m-4 p-3 flex flex-col gap-6 outline-2 outline-dourado-ocre"
    id="submitForm"
    target="formsubmit-iframe"
  >
    <input type="hidden" name="_next" value={`${baseUrl}/form-success`} />
    <input
      type="hidden"
      name="_subject"
      value="Tenho interesse e quero que analise meu caso!"
    />
    <input
      type="hidden"
      name="_blacklist"
      value="Ganhe dinheiro rÃ¡pido, Oferta exclusiva, Clique aqui agora, 100% grÃ¡tis, Sem compromisso, Aproveite antes que acabe, VocÃª foi selecionado, ParabÃ©ns, vocÃª ganhou, NÃ£o perca essa chance, Garantia de satisfaÃ§Ã£o, Livre de riscos, Apenas hoje, Oferta limitada, FaÃ§a seu cadastro agora, Dinheiro fÃ¡cil, Trabalhe de casa, Sem custo, CrÃ©dito aprovado, Aumente seus ganhos, PromoÃ§Ã£o imperdÃ­vel"
    />
    <input type="hidden" name="_template" value="table" />
    <input type="text" name="_honey" style="display:none" aria-hidden="true" />
    <input type="hidden" name="_captcha" value="true" />
    <div class="flex flex-col gap-2 p-2 bg-branco-gelo/20">
      <label
        for="nome"
        class="text-lg font-serif font-semibold text-branco-gelo">Nome:</label
      >
      <input
        type="text"
        name="nome"
        id="nome"
        placeholder="Maria Oliveira"
        class="p-1 border-1 border-dourado-ocre w-full placeholder-branco-gelo text-branco-gelo font-serif"
        required
      />
    </div>
    <div class="flex flex-col gap-2 p-2 bg-branco-gelo/20">
      <label
        for="telefone"
        class="text-lg font-serif font-semibold text-branco-gelo"
        >NÂº de telefone/celular:</label
      >
      <input
        type="tel"
        id="telefone"
        name="telefone"
        placeholder="(99) 99999-9999"
        required
        title="Digite um nÃºmero de telefone vÃ¡lido no formato (99) 99999-9999"
        class="p-1 border-1 border-dourado-ocre w-full placeholder-branco-gelo text-branco-gelo font-serif"
      />
    </div>
    <div class="flex flex-col gap-2 p-2 bg-branco-gelo/20">
      <label
        for="email"
        class="text-lg font-serif font-semibold text-branco-gelo">Email:</label
      >
      <input
        type="email"
        name="email"
        id="email"
        placeholder="seuemail@email.com"
        required
        class="p-1 border-1 border-dourado-ocre w-full placeholder-branco-gelo text-branco-gelo font-serif"
      />
    </div>
    <div class="flex flex-col gap-2 p-2 bg-branco-gelo/20">
      <label
        for="data"
        class="text-lg font-serif font-semibold text-branco-gelo">Data:</label
      >
      <input
        type="date"
        id="data"
        name="data"
        class="p-1 border-1 border-dourado-ocre w-full placeholder-branco-gelo text-branco-gelo font-serif"
      />
    </div>
    <div class="flex flex-col gap-2 p-2 bg-branco-gelo/20">
      <label
        for="hora"
        class="text-lg font-serif font-semibold text-branco-gelo"
        >HorÃ¡rio:</label
      >
      <input
        type="time"
        id="hora"
        name="horario"
        class="p-1 border-1 border-dourado-ocre w-full placeholder-branco-gelo text-branco-gelo font-serif"
      />
    </div>
    <div class="flex flex-col gap-2 p-2 bg-branco-gelo/20">
      <label
        for="descricao"
        class="text-lg font-serif font-semibold text-branco-gelo"
        >Como posso te ajudar?</label
      >

      <textarea
        id="descricao"
        name="descricao"
        rows="5"
        cols="33"
        placeholder="Gostaria de fazer uma avaliaÃ§Ã£o geral..."
        class="p-1 border-1 border-dourado-ocre w-full placeholder-branco-gelo text-branco-gelo font-serif"
      ></textarea>
    </div>
    <input type="text" name="_honey" aria-hidden="true" style="display:none" />
    <iframe
      name="formsubmit-iframe"
      id="formsubmit-iframe"
      style="display: none; border: none; width: 100%; height: 400px;"></iframe>
    <button
      type="submit"
      class="bg-dourado-ocre outline-1 p-2 w-full hover:scale-105 font-spectral font-bold text-2xl text-branco-gelo"
      >Enviar</button
    >
  </form>

  <section class="relative m-4 p-2 outline-2 outline-dourado-ocre">
    <div class="flex items-center justify-center gap-6 bg-branco-gelo/20 p-2">
      <p class="font-serif text-lg font-semibold text-white w-1/2">
        Se prefere contato no WhatsApp ðŸ‘‰
      </p>
      <a
        id="whatsappLink"
        href="#"
        aria-label="WhatsApp"
        target="_blank"
        rel="noopener noreferrer"
        class="block shake-anchor"
      >
        <Image
          src={wpIcon}
          alt="whats app icon"
          width={200}
          height={200}
          class="w-12 min-w-12 h-12 shrink-0"
        />
      </a>
    </div>
  </section>
</section>

<style>
  .shake-anchor {
    display: inline-block;
    transform-origin: bottom center;
    animation: periodicShake 3s ease-in-out infinite;
  }

  @keyframes periodicShake {
    0%,
    75%,
    100% {
      transform: rotate(0deg);
    }
    88% {
      transform: rotate(12deg);
    }
    85% {
      transform: rotate(-12deg);
    }
    90% {
      transform: rotate(12deg);
    }
    95% {
      transform: rotate(-12deg);
    }
  }
</style>

<script>
  const telefoneInput = document.getElementById("telefone");

  telefoneInput.addEventListener("input", function (e) {
    let valor = e.target.value.replace(/\D/g, "");

    // Aplica mÃ¡scara: (00) 00000-0000
    if (valor.length > 2)
      valor = `(${valor.substring(0, 2)}) ${valor.substring(2)}`;
    if (valor.length > 10)
      valor = `${valor.substring(0, 10)}-${valor.substring(10)}`;

    e.target.value = valor.substring(0, 15); // Limita o comprimento
  });

  document
    .getElementById("submitForm")
    .addEventListener("submit", function (e) {
      // Prevent default submission only for initial setup
      e.preventDefault();

      // Create temporary hidden iframe
      const iframe = document.getElementById("formsubmit-iframe");
      iframe.style.display = "block";

      // Programmatically submit form to preserve POST method
      this.submit();
    });

  window.addEventListener("message", function (e) {
    if (e.data === "form-submitted") {
      document.getElementById("formsubmit-iframe").style.display = "none";
      // Show success message
      alert("FormulÃ¡rio preenchido com sucesso!");
      // Optional: Reset form
      document.getElementById("submitForm").reset();
    }
  });

  function redirectToWhatsapp(message) {
    const url = new URL("/api/whatsapp", window.location.origin);
    url.searchParams.append("message", message);
    window.open(url.toString(), "_blank", "noopener,noreferrer");
  }

  document.getElementById("whatsappLink").addEventListener("click", (e) => {
    e.preventDefault();

    const message =
      "OlÃ¡, tudo bem? Tenho interesse em saber como a Dra. Vera JÃºlia Matos pode ajudar no meu caso.\n\nFico no aguardo da resposta.";

    redirectToWhatsapp(message);
  });
</script>
