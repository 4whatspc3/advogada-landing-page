---
import { Image } from "astro:assets";
import bgContact from "../../assets/contact-assets/bg-contact.jpg";
const baseUrl = import.meta.env.PUBLIC_BASE_URL;
---

<section class="min-h-svh relative flex flex-col gap-2">
  <Image
    src={bgContact}
    alt="background image"
    class="top-0 w-full h-full object-cover object-right absolute"
  />
  <div class="absolute w-full h-full bg-black/65"></div>
  <h2
    class="relative p-6 text-branco-gelo text-3xl text-center text-outline font-bold font-spectral"
  >
    Dê o Primeiro Passo Para Defender Seus Direitos
  </h2>
  <h3
    class="relative p-6 font-spectral text-lg text-center text-branco-gelo font-medium"
  >
    Sua mensagem é confidencial e será analisada por um especialista. Preencha o
    formulário abaixo ou, se preferir, nos chame diretamente no <span
      class="text-emerald-500 font-bold">WhatsApp</span
    >.
  </h3>
  <form
    action="https://formsubmit.co/8cad7644f3d0878fa0988faee39f8848"
    method="POST"
    class="relative m-4 p-3 flex flex-col gap-6 outline-2 outline-dourado-ocre"
    id="submitForm"
    target="formsubmit-iframe"
  >
    <input type="hidden" name="_next" value={`${baseUrl}/form-success`} />
    <input
      type="hidden"
      name="_subject"
      value="Tenho interesse e quero que analise meu caso!"
    />
    <input
      type="hidden"
      name="_blacklist"
      value="Ganhe dinheiro rápido, Oferta exclusiva, Clique aqui agora, 100% grátis, Sem compromisso, Aproveite antes que acabe, Você foi selecionado, Parabéns, você ganhou, Não perca essa chance, Garantia de satisfação, Livre de riscos, Apenas hoje, Oferta limitada, Faça seu cadastro agora, Dinheiro fácil, Trabalhe de casa, Sem custo, Crédito aprovado, Aumente seus ganhos, Promoção imperdível"
    />
    <input type="hidden" name="_template" value="table" />
    <input type="text" name="_honey" style="display:none" aria-hidden="true" />
    <input type="hidden" name="_captcha" value="true" />
    <div class="flex flex-col gap-2 p-2">
      <label
        for="nome"
        class="text-lg font-serif font-semibold text-branco-gelo">Nome:</label
      >
      <input
        type="text"
        name="nome"
        id="nome"
        placeholder="Maria Oliveira"
        class="p-1 border-1 border-dourado-ocre w-full placeholder-branco-gelo text-branco-gelo font-serif"
        required
      />
    </div>
    <div class="flex flex-col gap-2 p-2">
      <label
        for="telefone"
        class="text-lg font-serif font-semibold text-branco-gelo"
        >Nº de telefone/celular:</label
      >
      <input
        type="tel"
        id="telefone"
        name="telefone"
        placeholder="(99) 99999-9999"
        required
        title="Digite um número de telefone válido no formato (99) 99999-9999"
        class="p-1 border-1 border-dourado-ocre w-full placeholder-branco-gelo text-branco-gelo font-serif"
      />
    </div>
    <div class="flex flex-col gap-2 p-2">
      <label
        for="email"
        class="text-lg font-serif font-semibold text-branco-gelo">Email:</label
      >
      <input
        type="email"
        name="email"
        id="email"
        placeholder="seuemail@email.com"
        required
        class="p-1 border-1 border-dourado-ocre w-full placeholder-branco-gelo text-branco-gelo font-serif"
      />
    </div>
    <div class="flex flex-col gap-2 p-2">
      <label
        for="data"
        class="text-lg font-serif font-semibold text-branco-gelo">Data:</label
      >
      <input
        type="date"
        id="data"
        name="data"
        class="p-1 border-1 border-dourado-ocre w-full placeholder-branco-gelo text-branco-gelo font-serif"
      />
    </div>
    <div class="flex flex-col gap-2 p-2">
      <label
        for="hora"
        class="text-lg font-serif font-semibold text-branco-gelo"
        >Horário:</label
      >
      <input
        type="time"
        id="hora"
        name="horario"
        class="p-1 border-1 border-dourado-ocre w-full placeholder-branco-gelo text-branco-gelo font-serif"
      />
    </div>
    <div class="flex flex-col gap-2 p-2">
      <label
        for="descricao"
        class="text-lg font-serif font-semibold text-branco-gelo"
        >Como posso te ajudar?</label
      >

      <textarea
        id="descricao"
        name="descricao"
        rows="5"
        cols="33"
        placeholder="Gostaria de fazer uma avaliação geral..."
        class="p-1 border-1 border-dourado-ocre w-full placeholder-branco-gelo text-branco-gelo font-serif"
      ></textarea>
    </div>
    <input type="text" name="_honey" aria-hidden="true" style="display:none" />
    <iframe
      name="formsubmit-iframe"
      id="formsubmit-iframe"
      style="display: none; border: none; width: 100%; height: 400px;"></iframe>
    <button
      type="submit"
      class="bg-dourado-ocre outline-1 bg-branco-gelo p-2 w-full hover:scale-105 font-spectral font-bold text-2xl text-branco-gelo"
      >Enviar</button
    >
  </form>
</section>

<script>
  const telefoneInput = document.getElementById("telefone");

  telefoneInput.addEventListener("input", function (e) {
    let valor = e.target.value.replace(/\D/g, "");

    // Aplica máscara: (00) 00000-0000
    if (valor.length > 2)
      valor = `(${valor.substring(0, 2)}) ${valor.substring(2)}`;
    if (valor.length > 10)
      valor = `${valor.substring(0, 10)}-${valor.substring(10)}`;

    e.target.value = valor.substring(0, 15); // Limita o comprimento
  });

  document
    .getElementById("submitForm")
    .addEventListener("submit", function (e) {
      // Prevent default submission only for initial setup
      e.preventDefault();

      // Create temporary hidden iframe
      const iframe = document.getElementById("formsubmit-iframe");
      iframe.style.display = "block";

      // Programmatically submit form to preserve POST method
      this.submit();
    });

  window.addEventListener("message", function (e) {
    if (e.data === "form-submitted") {
      document.getElementById("formsubmit-iframe").style.display = "none";
      // Show success message
      alert("Formulário preenchido com sucesso!");
      // Optional: Reset form
      document.getElementById("submitForm").reset();
    }
  });
</script>
